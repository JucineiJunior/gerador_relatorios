{% extends "base.html" %}
{% block content %}
<div class="container text-light">
  {% if relatorio_selecionado %}
    <h3>{{ relatorio_selecionado.nome }}</h3>

    <!-- Formulário de filtros -->
    <form method="get">
      <input type="hidden" name="relatorio_id" value="{{ relatorio_selecionado.id }}">
      {% for filtro in relatorio_selecionado.filtros %}
        <label>{{ filtro }}:</label>
        <input type="text" name="{{ filtro }}" value="{{ filtros_aplicados }}">
      {% endfor %}
      <button type="submit">Aplicar Filtros</button>
    </form>

    <!-- Resultados -->
    {% if dados %}
      <h4>Resultados:</h4>
      <table border="1">
        <thead>
          <tr>
            {% for k in dados.0.keys %}
              <th>{{ k }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for linha in dados %}
            <tr>
              {% for valor in linha.values %}
                <td>{{ valor }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Exportações -->
      <div style="margin-top: 1rem;">
        <form method="get" action="{% url 'exportar_relatorio' relatorio_selecionado.id %}">
          {% for k, v in filtros_aplicados.items %}
            <input type="hidden" name="{{ k }}" value="{{ v }}">
          {% endfor %}
          <button name="formato" value="csv">Exportar CSV</button>
          <button name="formato" value="xlsx">Exportar Excel</button>
          <button name="formato" value="pdfv">Exportar PDF (Vertical)</button>
          <button name="formato" value="pdfh">Exportar PDF (Horizontal)</button>
        </form>
      </div>
    {% else %}
      <p>Nenhum resultado encontrado.</p>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
